<div><br class="Apple-interchange-newline">import streamlit as st<br>import pandas as pd<br>from datetime import datetime<br>from supabase import create_client<br><br># =====================================================<br># ğŸ” PasswÃ¶rter<br># =====================================================<br>USER_PASSWORD = "welovekb"<br>ADMIN_PASSWORD = "sebaforceo"<br><br># =====================================================<br># ğŸ§  Supabase<br># =====================================================<br>supabase = create_client(<br> st.secrets["SUPABASE_URL"],<br> st.secrets["SUPABASE_KEY"]<br>)<br><br>def log_login(role, success):<br> supabase.table("login_events").insert({<br> "role": role,<br> "success": success,<br> "created_at": datetime.utcnow().isoformat()<br> }).execute()<br><br># =====================================================<br># ğŸ§  Session State Initialisierung<br># =====================================================<br>st.session_state.setdefault("logged_in", False)<br>st.session_state.setdefault("is_admin", False)<br>st.session_state.setdefault("USER_PASSWORD", USER_PASSWORD)<br>st.session_state.setdefault("show_map", False)<br><br># =====================================================<br># ğŸ” Login<br># =====================================================<br>def login(password):<br> user_pw = st.session_state.get("USER_PASSWORD", USER_PASSWORD)<br> if password == user_pw:<br> st.session_state.logged_in = True<br> st.session_state.is_admin = False<br> log_login("User", True)<br> st.rerun()<br> elif password == ADMIN_PASSWORD:<br> st.session_state.logged_in = True<br> st.session_state.is_admin = True<br> log_login("Admin", True)<br> st.rerun()<br> else:<br> log_login("Unknown", False)<br> st.error("âŒ Falsches Passwort")<br><br>if not st.session_state.logged_in:<br> st.title("ğŸ” Login erforderlich")<br> pw = st.text_input("Passwort", type="password")<br> if st.button("Login"):<br> login(pw)<br> st.stop()<br><br># =====================================================<br># ğŸ‘‘ Admin Backend<br># =====================================================<br>if st.session_state.is_admin:<br> st.header("ğŸ‘‘ Admin Dashboard")<br><br> data = supabase.table("login_events").select("*").order("created_at", desc=True).execute()<br> df = pd.DataFrame(data.data)<br> if not df.empty:<br> df["Datum"] = pd.to_datetime(df["created_at"]).dt.date<br> st.subheader("ğŸ“„ Login-Historie")<br> st.dataframe(df, use_container_width=True)<br> st.subheader("ğŸ“Š Logins pro Tag")<br> logins_per_day = df[df["success"]==True].groupby("Datum").size().reset_index(name="Logins")<br> st.dataframe(logins_per_day, use_container_width=True)<br> st.bar_chart(logins_per_day.set_index("Datum"))<br> csv = df.to_csv(index=False).encode("utf-8")<br> st.download_button("CSV Export", csv, "login_history.csv", "text/csv")<br> else:<br> st.info("Noch keine Login-Daten vorhanden.")<br><br> st.subheader("ğŸ”‘ User Passwort Ã¤ndern")<br> new_password = st.text_input("Neues User-Passwort", type="password")<br> if st.button("Update User Passwort"):<br> if new_password:<br> st.session_state['USER_PASSWORD'] = new_password<br> st.success("âœ… Passwort erfolgreich geÃ¤ndert!")<br> else:<br> st.warning("Bitte ein gÃ¼ltiges Passwort eingeben.")<br> st.stop()<br><br># =====================================================<br># ğŸ”§ App Setup<br># =====================================================<br>st.set_page_config(page_title="Kalkulations-App", layout="wide")<br>st.title("ğŸ“Š Kalkulations-App")<br><br># ğŸ—‚ Seitenauswahl (Sidebar)<br>page = st.sidebar.radio(<br> "WÃ¤hle eine Kalkulation:",<br> ["Platform", "Cardpayment", "Pricing", "Radien"]<br>)<br><br># ==========================<br># Hilfsfunktionen fÃ¼r persistente Inputs<br># ==========================<br>def persistent_number_input(label, key, value=0.0, **kwargs):<br> st.session_state.setdefault(key, value)<br> st.session_state[key] = st.number_input(label, value=st.session_state[key], key=f"ui_{key}", **kwargs)<br> return st.session_state[key]<br><br>def persistent_text_input(label, key, value="", **kwargs):<br> st.session_state.setdefault(key, value)<br> st.session_state[key] = st.text_input(label, value=st.session_state[key], key=f"ui_{key}", **kwargs)<br> return st.session_state[key]<br><br>def persistent_selectbox(label, key, options, index=0, **kwargs):<br> st.session_state.setdefault(key, options[index])<br> st.session_state[key] = st.selectbox(label, options, index=options.index(st.session_state[key]), **kwargs)<br> return st.session_state[key]<br><br># =====================================================<br># ğŸ Platform<br># =====================================================<br>if page == "Platform":<br> st.header("ğŸ Platform Kalkulation")<br> col1, col2 = st.columns([2, 1.5])<br><br> with col1:<br> st.subheader("Eingaben")<br> revenue = persistent_number_input("Revenue on platform (â‚¬)", "revenue", 0.0, step=250.0)<br> commission_pct = persistent_number_input("Commission (%)", "commission_pct", 14.0, step=1.0)<br> avg_order_value = persistent_number_input("Average order value (â‚¬)", "avg_order_value", 25.0, step=5.0)<br> service_fee = persistent_number_input("Service Fee (â‚¬)", "service_fee", 0.69, step=0.1)<br><br> total_cost = revenue*(commission_pct/100) + \<br> (0.7*revenue/avg_order_value if avg_order_value else 0)*service_fee<br><br> st.markdown("### ğŸ’¶ Cost on Platform")<br> st.markdown(f"<div style='color:red; font-size:28px;'>{total_cost:,.2f} â‚¬</div>", unsafe_allow_html=True)<br><br> st.markdown("---")<br> st.subheader("Vertragsdetails")<br> OTF = persistent_number_input("One Time Fee (OTF) (â‚¬)", "OTF", 0.0, step=100.0)<br> MRR = persistent_number_input("Monthly Recurring Revenue (MRR) (â‚¬)", "MRR", 0.0, step=10.0)<br> contract_length = persistent_number_input("Contract length (Monate)", "contract_length", 24, step=12)<br><br> transaction = 0.7*revenue/5*0.35<br> cost_monthly = MRR + transaction<br> saving_monthly = total_cost - cost_monthly<br> saving_over_contract = saving_monthly*contract_length<br><br> st.subheader("ğŸ“Š Kennzahlen")<br> st.info(<br> f"- Cost monthly: {cost_monthly:,.2f} â‚¬\n"<br> f"- Saving monthly: {saving_monthly:,.2f} â‚¬\n"<br> f"- Saving over contract length: {saving_over_contract:,.2f} â‚¬"<br> )<br><br># =====================================================<br># ğŸ’³ Cardpayment<br># =====================================================<br>elif page == "Cardpayment":<br> st.header("ğŸ’³ Cardpayment Vergleich")<br> col1, col2 = st.columns(2)<br><br> with col1:<br> st.subheader("Actual")<br> rev_a = persistent_number_input("Revenue (â‚¬)", "rev_a", 0.0, step=250.0)<br> sum_a = persistent_number_input("Sum of payments", "sum_a", 0.0, step=20.0)<br> mrr_a = persistent_number_input("Monthly Fee (â‚¬)", "mrr_a", 0.0, step=5.0)<br> comm_a = persistent_number_input("Commission (%)", "comm_a", 1.39, step=0.01)<br> auth_a = persistent_number_input("Authentification Fee (â‚¬)", "auth_a", 0.0)<br><br> with col2:<br> st.subheader("Offer")<br> rev_o = persistent_number_input("Revenue (â‚¬)", "rev_o", rev_a, step=250.0)<br> sum_o = persistent_number_input("Sum of payments", "sum_o", sum_a, step=20.0)<br> mrr_o = persistent_number_input("Monthly Fee (â‚¬)", "mrr_o", 0.0, step=5.0)<br> comm_o = persistent_number_input("Commission (%)", "comm_o", 1.19, step=0.01)<br> auth_o = persistent_number_input("Authentification Fee (â‚¬)", "auth_o", 0.06)<br><br> total_actual = rev_a*(comm_a/100) + sum_a*auth_a + mrr_a<br> total_offer = rev_o*(comm_o/100) + sum_o*auth_o + mrr_o<br> saving = total_offer - total_actual<br><br> st.markdown("---")<br> col3, col4, col5 = st.columns(3)<br> col3.markdown(f"<div style='color:red; font-size:28px;'>ğŸ’³ {total_actual:,.2f} â‚¬</div>", unsafe_allow_html=True)<br> col3.caption("Total Actual")<br> col4.markdown(f"<div style='color:blue; font-size:28px;'>ğŸ’³ {total_offer:,.2f} â‚¬</div>", unsafe_allow_html=True)<br> col4.caption("Total Offer")<br> col5.markdown(f"<div style='color:green; font-size:28px;'>ğŸ’° {saving:,.2f} â‚¬</div>", unsafe_allow_html=True)<br> col5.caption("Ersparnis (Offer - Actual)")<br><br># =====================================================<br># ğŸ’° Pricing<br># =====================================================<br>elif page == "Pricing":<br> st.header("ğŸ’° Pricing Kalkulation")<br><br> # --- Software inkl Connect ---<br> df_sw = pd.DataFrame({<br> "Produkt": ["Shop", "App", "POS", "Pay", "Connect", "GAW"],<br> "Min_OTF": [365, 15, 365, 35, 0, 0],<br> "List_OTF": [999, 49, 999, 49, 0, 0],<br> "Min_MRR": [50, 15, 49, 5, 15, 0],<br> "List_MRR": [119, 49, 89, 25, 15, 0]<br> })<br><br> # --- Hardware ---<br> df_hw = pd.DataFrame({<br> "Produkt":["Ordermanager","POS inkl 1 Printer","Cash Drawer","Extra Printer","Additional Display","PAX"],<br> "Min_OTF":[135,350,50,99,100,225],<br> "List_OTF":[299,1699,149,199,100,299],<br> "Min_MRR":[0]*6,<br> "List_MRR":[0]*6<br> })<br><br> # --- Session State Mengen ---<br> for i in range(len(df_sw)):<br> st.session_state.setdefault(f"sw_{i}", 0)<br> for i in range(len(df_hw)):<br> st.session_state.setdefault(f"hw_{i}", 0)<br><br> # --- Eingaben Software/Hardware ---<br> col1, col2 = st.columns(2)<br> with col1:<br> st.subheader("Software")<br> for i, p in enumerate(df_sw["Produkt"]):<br> st.session_state[f"sw_{i}"] = st.number_input(p, min_value=0, step=1, key=f"sw_ui_{i}")<br> with col2:<br> st.subheader("Hardware")<br> for i, p in enumerate(df_hw["Produkt"]):<br> st.session_state[f"hw_{i}"] = st.number_input(p, min_value=0, step=1, key=f"hw_ui_{i}")<br><br> # --- Berechnung Gesamtpreise ---<br> df_sw["Menge"] = [st.session_state[f"sw_{i}"] for i in range(len(df_sw))]<br> df_hw["Menge"] = [st.session_state[f"hw_{i}"] for i in range(len(df_hw))]<br><br> list_otf = (df_sw["Menge"]*df_sw["List_OTF"]).sum() + (df_hw["Menge"]*df_hw["List_OTF"]).sum()<br> min_otf = (df_sw["Menge"]*df_sw["Min_OTF"]).sum() + (df_hw["Menge"]*df_hw["Min_OTF"]).sum()<br> list_mrr = (df_sw["Menge"]*df_sw["List_MRR"]).sum()<br> min_mrr = (df_sw["Menge"]*df_sw["Min_MRR"]).sum()<br><br> # --- LIST PREISE oben ---<br> st.markdown("### ğŸ§¾ LIST PREISE")<br> st.markdown(f"**OTF LIST gesamt:** {list_otf:,.2f} â‚¬")<br> st.markdown(f"**MRR LIST gesamt:** {list_mrr:,.2f} â‚¬")<br> st.markdown("---")<br><br> # --- Rabattfunktion ---<br> st.subheader("ğŸ’¸ Rabattfunktion")<br> col_otf, col_otf_reason = st.columns([1,3])<br> with col_otf:<br> st.session_state['discount_otf'] = st.selectbox("OTF Rabatt (%)", [0,5,10,15,20,25,30,35,40,45,50], <br> index=[0,5,10,15,20,25,30,35,40,45,50].index(st.session_state.get('discount_otf',0)))<br> with col_otf_reason:<br> st.session_state['reason_otf'] = st.text_input("Grund OTF Rabatt", value=st.session_state.get('reason_otf',''))<br> if st.session_state['discount_otf'] > 0 and len(st.session_state['reason_otf']) < 10:<br> st.warning("Bitte BegrÃ¼ndung eintragen (mindestens 10 Zeichen).")<br><br> col_mrr, col_mrr_reason = st.columns([1,3])<br> with col_mrr:<br> st.session_state['discount_mrr'] = st.selectbox("MRR Rabatt (%)", [0,5,10,15,20,25,30,35,40,45,50], <br> index=[0,5,10,15,20,25,30,35,40,45,50].index(st.session_state.get('discount_mrr',0)))<br> with col_mrr_reason:<br> st.session_state['reason_mrr'] = st.text_input("Grund MRR Rabatt", value=st.session_state.get('reason_mrr',''))<br> if st.session_state['discount_mrr'] > 0 and len(st.session_state['reason_mrr']) < 10:<br> st.warning("Bitte BegrÃ¼ndung eintragen (mindestens 10 Zeichen).")<br><br> # --- Berechnete Preise nach Rabatt ---<br> otf_discounted = list_otf * (1 - st.session_state['discount_otf']/100) if st.session_state['discount_otf'] > 0 and len(st.session_state['reason_otf']) >= 10 else list_otf<br> mrr_discounted = list_mrr * (1 - st.session_state['discount_mrr']/100) if st.session_state['discount_mrr'] > 0 and len(st.session_state['reason_mrr']) >= 10 else list_mrr<br><br> st.info(f"OTF nach Rabatt: {otf_discounted:,.2f} â‚¬")<br> st.info(f"MRR nach Rabatt: {mrr_discounted:,.2f} â‚¬")<br><br> # --- MIN PREISE unten ---<br> st.markdown("---")<br> st.markdown("### ğŸ”» MIN PREISE")<br> st.markdown(f"**OTF MIN gesamt:** {min_otf:,.2f} â‚¬")<br> st.markdown(f"**MRR MIN gesamt:** {min_mrr:,.2f} â‚¬")<br><br># =====================================================<br># ğŸ—ºï¸ Radien<br># =====================================================<br>elif page == "Radien":<br> import folium<br> from geopy.geocoders import Nominatim<br> from streamlit_folium import st_folium<br><br> st.header("ğŸ—ºï¸ Radien um eine Adresse")<br><br> adresse = persistent_text_input("Adresse eingeben", "adresse")<br> radien_input = persistent_text_input("Radien eingeben (km, durch Komma getrennt)", "radien_input", "5,10")<br><br> if st.button("Karte anzeigen"):<br> st.session_state['show_map'] = True<br><br> if st.session_state.get('show_map', False):<br> if adresse.strip() and radien_input.strip():<br> try:<br> radien = [float(r.strip()) for r in radien_input.split(",") if r.strip()]<br> except ValueError:<br> st.warning("Bitte nur Zahlen fÃ¼r Radien eingeben, getrennt durch Komma.")<br> radien = []<br><br> if radien:<br> geolocator = Nominatim(user_agent="streamlit-free-radius-map", timeout=10)<br> try:<br> location = geolocator.geocode(adresse)<br> if location:<br> lat, lon = location.latitude, location.longitude<br><br> m = folium.Map(location=[lat, lon], zoom_start=12)<br> folium.Marker(<br> [lat, lon],<br> popup=adresse,<br> tooltip="Zentrum",<br> icon=folium.Icon(color="red", icon="info-sign")<br> ).add_to(m)<br><br> bounds = []<br> for r in radien:<br> folium.Circle(<br> location=[lat, lon],<br> radius=r*1000,<br> color="blue",<br> weight=2,<br> fill=True,<br> fill_opacity=0.15<br> ).add_to(m)<br><br> bounds.append([lat + r/111, lon + r/111])<br> bounds.append([lat - r/111, lon - r/111])<br><br> m.fit_bounds(bounds)<br> st_folium(m, width=1000, height=600)<br> else:<br> st.warning("Adresse nicht gefunden.")<br> except Exception as e:<br> st.error(f"Fehler bei Geocoding: {e}")<br> else:<br> st.warning("Bitte gÃ¼ltige Radien eingeben.")<br> else:<br> st.warning("Bitte Adresse eingeben und mindestens einen Radius angeben.")<br><br># =====================================================<br># Footer<br># =====================================================<br>st.markdown("""<br><hr><br><p style='text-align:center; font-size:0.8rem; color:gray;'><br>ğŸ˜‰ Traue niemals Zahlen, die du nicht selbst gefÃ¤lscht hast ğŸ˜‰<br></p><br>""", unsafe_allow_html=True)</div>


